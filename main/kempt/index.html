<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Kempt"><title>kempt - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-c4dbdcde0fbd8430.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-db279b6232be9c13.css"><link rel="stylesheet" disabled href="../static.files/dark-cf923f49f397b216.css"><link rel="stylesheet" disabled href="../static.files/ayu-be46fdc453a55015.css"><script src="../static.files/storage-3891ce972e3a2bf8.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-98a684e84ae5b08b.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../kempt/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../kempt/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate kempt</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">kempt</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/kempt/lib.rs.html#1-83">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="kempt"><a href="#kempt">Kempt</a></h2>
<p>A <code>#[forbid_unsafe]</code> ordered collection crate for Rust. This crate is <code>no_std</code>
compatible using the <code>alloc</code> crate.</p>
<p><a href="https://crates.io/crates/kempt"><img src="https://img.shields.io/crates/v/kempt.svg" alt="crate version" /></a>
<a href="https://github.com/khonsulabs/kempt/actions?query=workflow:Tests"><img src="https://img.shields.io/github/actions/workflow/status/khonsulabs/kempt/rust.yml?branch=main" alt="Live Build Status" /></a>
<a href="https://khonsulabs.github.io/kempt/coverage/"><img src="https://khonsulabs.github.io/kempt/coverage/badge.svg" alt="HTML Coverage Report for main branch" /></a>
<a href="https://khonsulabs.github.io/kempt/main/kempt"><img src="https://img.shields.io/badge/docs-main-informational" alt="Documentation for main branch" /></a></p>
<h3 id="mapk-v"><a href="#mapk-v"><code>Map&lt;K, V&gt;</code></a></h3>
<p><a href="https://khonsulabs.github.io/kempt/main/kempt/struct.Map.html"><code>Map&lt;K,V&gt;</code></a> provides an interface similar to a <code>BTreeMap&lt;K,V&gt;</code>, but
utilizes a simpler storage model. The entries are stored in a <code>Vec</code>, ordered by
the keys. Retrieving values uses a hybrid binary search and sequential scan
algorithm that is aimed at taking advantage of sequential scans for better cache
performance.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>kempt::Map;

<span class="kw">let </span><span class="kw-2">mut </span>map = Map::new();
map.insert(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);
map.insert(<span class="string">&quot;b&quot;</span>, <span class="number">2</span>);
<span class="macro">assert_eq!</span>(map.get(<span class="kw-2">&amp;</span><span class="string">&quot;a&quot;</span>), <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="number">1</span>));
<span class="kw">let </span>replaced = map.insert(<span class="string">&quot;a&quot;</span>, <span class="number">2</span>).expect(<span class="string">&quot;value exists&quot;</span>);
<span class="macro">assert_eq!</span>(map.get(<span class="kw-2">&amp;</span><span class="string">&quot;a&quot;</span>), <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="number">2</span>));
<span class="macro">assert_eq!</span>(replaced.value, <span class="number">1</span>);</code></pre></div>
<h4 id="why-use-map-instead-of-btreemap-or-hashmap"><a href="#why-use-map-instead-of-btreemap-or-hashmap">Why use <code>Map</code> instead of <code>BTreeMap</code> or <code>HashMap</code>?</a></h4>
<p>The <a href="https://khonsulabs.github.io/kempt/main/kempt/struct.Map.html"><code>Map</code></a> type provides several operations that the standard library Map
types do not:</p>
<ul>
<li>Ability to merge maps (<a href="https://khonsulabs.github.io/kempt/main/kempt/struct.Map.html#method.merge_with"><code>merge_with()</code></a>)</li>
<li>Entry API that supports owned or borrowed representations, and only uses
<code>ToOwned</code> when inserting borrowed key into a vacant entry</li>
<li>Ability to access fields by index in addition to the key type</li>
</ul>
<p>Overall, the <code>Map</code> type is very similar to the <code>BTreeMap</code> type, except that it
utilizes a single storage buffer. Because of this simplified storage model, the
<code>Map</code> type supports preallocation <code>with_capacity()</code>, while <code>BTreeMap</code> does not.</p>
<p>The <code>Map</code> type will not perform as well as <code>BTreeMap</code> when there is a
significant number of items in the collection (&gt; 1k, depending on Key and Value
sizes). Some operations, such as insertion and removal, will also be slower on
moderately large collections (&gt; 100 entries).</p>
<p>The <code>Map</code> type can be beneficial over using a <code>HashMap</code> for several reasons:</p>
<ul>
<li>Ordered iteration</li>
<li>Only requires <code>Ord</code></li>
<li>Growing does not require “rebinning”</li>
<li>May be faster for collections with fewer than ~100 elements (depending on Key
and Value sizes), due to:
<ul>
<li>No hashing of keys</li>
<li>When hash maps are more full, the likelihood of collisions increases.
Collisions require some sort of scan to find the matching key, and each key
comparison falls back to <code>Eq</code>.</li>
</ul>
</li>
</ul>
<p>The <code>HashMap</code> type is more beneficial for many other use cases:</p>
<ul>
<li>Large Key types that are expensive to compare</li>
<li>Moderately large collections (&gt; 100 entries, depending on Key and Value sizes)</li>
</ul>
<h3 id="why"><a href="#why">Why?</a></h3>
<p>This crate started as a thought experiment: when using <a href="https://github.com/khonsulabs/interner">interned
strings</a>, could an ordered <code>Vec</code> outperform a <code>HashMap</code> for “small”
collections. And, if it could, how would it compare to <code>BTreeMap</code>? The use case
being considered was <a href="https://github.com/khonsulabs/stylecs">stylecs</a>, where most collections were expected to
be well under 100 elements.</p>
<p>In addition to performing similarly or better than <code>HashMap</code> and <code>BTreeMap</code> for
the intended use cases, a generic <code>merge_with</code> API was designed that optimally
merges the contents of two collections together. This operation is expected to
be a common operation for <a href="https://github.com/khonsulabs/stylecs">stylecs</a>, and there is no optimal way to
write such an algorithm with <code>HashMap</code> or <code>BTreeMap</code>.</p>
<p>This collection <strong>is not always better than <code>HashMap</code> and/or <code>BTreeMap</code></strong>, and
depending on your <code>Key</code> and <code>Value</code> types, your mileage may vary. Before using
this in your own project, you should benchmark your intended use case to ensure
it meets your performance needs.</p>
<h3 id="benchmarks"><a href="#benchmarks">Benchmarks</a></h3>
<p>The benchmark suite can be run via cargo:</p>
<div class="example-wrap"><pre class="language-sh"><code>cargo bench -p benchmarks
</code></pre></div>
<p>The suite uses randomization, which means that each run may produce slightly
different results. However, each data structure is tested with the same
randomized data, so each individual run of a benchmark is a true comparison. The
randomization can be provided a stable seed to allow comparing the same data
sets by providing the <code>-s</code> option:</p>
<div class="example-wrap"><pre class="language-sh"><code># -s takes up to 64 hexadecimal digits to produce the random seed
cargo bench -p benchmarks -- -s0
</code></pre></div>
<p>Full results as run on Github Actions <a href="https://khonsulabs.github.io/kempt/benchmarks/report/index.html">can be viewed
here</a>, using a
randomized seed. Here are the results run from the developer’s machine (an AMD
Ryzen 7 3800X) for data sets containing 25 elements using <code>-s0</code>:</p>
<div><table><thead><tr><th>Benchmark</th><th>Key Type</th><th><a href="https://khonsulabs.github.io/kempt/main/kempt/struct.Map.html">Map</a></th><th>HashMap (<a href="https://github.com/servo/rust-fnv">fnv</a>)</th><th>BTreeMap</th></tr></thead><tbody>
<tr><td>fill random</td><td>u8</td><td>161.1ns</td><td>408.9ns</td><td>447.5ns</td></tr>
<tr><td>fill random</td><td>usize</td><td>157.7ns</td><td>289.2ns</td><td>451.5ns</td></tr>
<tr><td>fill random</td><td>u128</td><td>260.1ns</td><td>401.0ns</td><td>527.8ns</td></tr>
<tr><td>fill seq</td><td>u8</td><td>170.4ns</td><td>413.0ns</td><td>444.9ns</td></tr>
<tr><td>fill seq</td><td>usize</td><td>173.3ns</td><td>284.2ns</td><td>461.2ns</td></tr>
<tr><td>fill seq</td><td>u128</td><td>220.5ns</td><td>404.9ns</td><td>533.1ns</td></tr>
<tr><td>get</td><td>u8</td><td>5.0ns</td><td>4.1ns</td><td>5.5ns</td></tr>
<tr><td>get</td><td>usize</td><td>5.1ns</td><td>6.4ns</td><td>5.7ns</td></tr>
<tr><td>get</td><td>u128</td><td>7.3ns</td><td>11.7ns</td><td>6.9ns</td></tr>
<tr><td>remove</td><td>u8</td><td>19.4ns</td><td>25.6ns</td><td>187.1ns</td></tr>
<tr><td>remove</td><td>usize</td><td>28.2ns</td><td>34.6ns</td><td>199.8ns</td></tr>
<tr><td>remove</td><td>u128</td><td>32.2ns</td><td>41.2ns</td><td>203.8ns</td></tr>
</tbody></table>
</div>
<p>No benchmark suite is ever perfect. Pull requests are welcome. Each potential
user who cares about maximal performance should benchmark their own use case on
their target hardware rather than rely on these benchmark results.</p>
<h3 id="open-source-licenses"><a href="#open-source-licenses">Open-source Licenses</a></h3>
<p>This project, like all projects from <a href="https://khonsulabs.com/">Khonsu Labs</a>, are
open-source. This repository is available under the <a href="./LICENSE-MIT">MIT License</a>
or the <a href="./LICENSE-APACHE">Apache License 2.0</a>.</p>
<p>To learn more about contributing, please see <a href="./CONTRIBUTING.md">CONTRIBUTING.md</a>.</p>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.Map"><code>pub use map::<a class="struct" href="map/struct.Map.html" title="struct kempt::map::Map">Map</a>;</code></div></li></ul><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="map/index.html" title="mod kempt::map">map</a></div><div class="desc docblock-short">Types supporting the <a href="map/struct.Map.html" title="struct kempt::map::Map"><code>Map&lt;Key, Value&gt;</code></a> collection type.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.Sort.html" title="trait kempt::Sort">Sort</a></div><div class="desc docblock-short">Provides a comparison between <code>Self</code> and <code>Other</code>.</div></li></ul></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="kempt" data-themes="" data-resource-suffix="" data-rustdoc-version="1.69.0 (84c898d65 2023-04-16)" data-search-js="search-8a59a8356673ec1f.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" ></div></body></html>